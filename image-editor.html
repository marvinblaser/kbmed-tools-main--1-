<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Éditeur d'Images</title>

    <!-- Vos CSS -->
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/editor-styles.css" />
    <link rel="stylesheet" href="css/mediatheque-styles.css" />

    <!-- Cropper CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.css"
      rel="stylesheet"
    />

    <!-- Gun.js P2P (relay public, pas de config) -->
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <!-- html2canvas & Cropper.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.js"></script>
  </head>
  <body>
    <div id="header-container"></div>

    <!-- TRANSFERT via Gun.js -->
    <section style="padding:1em;border:1px solid #ccc;margin:1em 0;">
      <h2>Transfert d'image (téléphone → PC)</h2>
      <div style="margin-bottom:1em;">
        <strong>Sur le téléphone :</strong><br>
        <input type="file" id="transfer-input" accept="image/*"><br>
        <small>Sélectionnez une image pour l’envoyer.</small>
      </div>
      <div>
        <strong>Sur le PC :</strong><br>
        <small>L'image apparaît automatiquement dans l'éditeur.</small>
      </div>
    </section>

    <!-- ÉDITEUR D'IMAGES -->
    <main>
      <h1 id="editor-title">Éditeur d'images</h1>
      <div id="main-controls" class="editor-header">
        <div class="header-left">
          <label for="image-loader" class="btn">Importer un fichier</label>
          <input
            type="file"
            id="image-loader"
            class="hidden"
            accept="image/*"
            capture="environment"
          />
          <button id="open-media-library-btn" class="btn">
            Choisir depuis la médiathèque
          </button>
        </div>
        <div class="header-right">
          <button id="crop-tool-btn" class="btn icon-btn" title="Rogner">…</button>
          <button id="undo-btn" class="btn icon-btn" title="Annuler" disabled>…</button>
          <button
            id="text-tool-btn"
            class="btn icon-btn"
            title="Ajouter du texte"
          >…</button>
          <button id="reset-btn" class="btn icon-btn" title="Réinitialiser">…</button>
          <button
            id="delete-btn"
            class="btn icon-btn danger-bg"
            title="Supprimer la sélection"
            disabled
          >…</button>
        </div>
      </div>
      <div id="image-container">
        <img id="image-display" src="" alt="Votre image" />
      </div>
      <div class="actions-footer">
        <div id="crop-actions" class="hidden">
          <button id="confirm-crop-btn" class="btn btn-success">Confirmer</button>
          <button id="cancel-crop-btn" class="btn btn-danger">Annuler</button>
        </div>
        <div id="download-wrapper">
          <button id="download-btn" class="btn btn-primary">
            Télécharger l'image
          </button>
        </div>
      </div>
    </main>

    <div id="text-panel" class="hidden">
      <div class="panel-header">
        <h3>TEXTE</h3>
        <button id="close-text-panel-btn" class="btn icon-btn">&times;</button>
      </div>
      <div class="panel-body">
        <div>
          <label for="text-panel-input">Texte à insérer :</label>
          <input
            type="text"
            id="text-panel-input"
            placeholder="Votre texte ici..."
          />
          <button id="add-text-btn" class="btn btn-primary">Ajouter le texte</button>
        </div>
        <div>
          <label>Couleur du fond :</label>
          <div class="color-picker-wrapper">
            <input type="color" id="text-panel-color" value="#FFFFFF" />
            <span>Cliquez pour changer</span>
          </div>
        </div>
      </div>
    </div>

    <div id="media-modal" class="modal-overlay hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Choisir une image</h2>
          <button id="close-media-modal-btn" class="btn icon-btn">&times;</button>
        </div>
        <div id="modal-media-grid"></div>
      </div>
    </div>

    <!-- Scripts partagés et ton JS -->
    <script src="js/shared.js"></script>
    <script src="js/image-editor.js"></script>
  </body>
</html>